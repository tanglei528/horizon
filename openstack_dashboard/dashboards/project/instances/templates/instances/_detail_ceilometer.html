{% load i18n %}
{% load url from future %}

<!--
<div id="samples_url" url="{% url "horizon:admin:metering:samples" %}"></div>
<div id="ceilometer-stats">
  <form class="form-horizontal"
        id="linechart_general_form">
{{ instance.full_flavor.vcpus }}
    <div class="control-group">
      <label for="meter" class="control-label">{% trans "Metric" %}:&nbsp;</label>
      <div class="controls line_chart_time_picker">
        
      </div>
    </div>

  </form>
</div>
-->
<style>
.meter_image{
	background-color: #F0F4F6;
	background-image: url(/static/dashboard/img/drop_arrow_l2.png);
	background-position: 99% 50%;
	background-repeat: no-repeat;
	height:30px;
}
</style>
 
<div class="info row-fluid detail">
  <div class="span12">
    <h4 class="meter_image" id="cpu_title_image"><span style="line-height:2.5">{% trans "cpu" %}</span><span style="margin-left:39.5%">{% trans "cpu.util" %}</span><span style="margin-left:50%;cursor:pointer" onClick="showCPU();">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></h4>
    <hr class="header_rule" />
    <div id="cpu_cup_util" class="info row-fluid detail">
      <div class="span9 chart_container" style="width: 400px;">
          <div class="chart"
               data-chart-type="line_chart"
               data-url="{% url 'horizon:admin:metering:samples'%}?meter=cpu&group_by=project&date_options=null&resource_id={{ instance.id }}"
               data-form-selector='#linechart_general_form'
               data-legend-selector="#legend"
               data-smoother-selector="#smoother"
               data-slider-selector="#slider">
          </div>
          <div id="slider"></div>
        </div>
        
        <div class="span3 legend_container">
          <div class="span9 chart_container" style="width: 400px;">
          <div class="chart"
               data-chart-type="line_chart"
               data-url="{% url 'horizon:admin:metering:samples'%}?meter=cpu_util&group_by=project&date_options=null&resource_id={{ instance.id }}"
               data-form-selector='#linechart_general_form'
               data-legend-selector="#legend"
               data-smoother-selector="#smoother"
               data-slider-selector="#slider">
          </div>
          <div id="slider"></div>
        </div>
        
        </div>
        
        </div>
      </div>
    </div>
  </div>
</div>

<div class="info row-fluid detail">
  <div class="span12">
    <h4 class="meter_image" id="memory_title_image">{% trans "memory" %}<span style="margin-left:37%;line-height:2.5">{% trans "memory.usage" %}</span><span style="margin-left:45%;cursor:pointer" onClick="showMemory();">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></h4>
    <hr class="header_rule" />
    <div id="memory_memory_usage" class="info row-fluid detail">
      <div class="span9 chart_container" style="width: 400px;">
          <div class="chart"
               data-chart-type="line_chart"
               data-url="{% url 'horizon:admin:metering:samples'%}?meter=memory&group_by=project&date_options=null&resource_id={{ instance.id }}"
               data-form-selector='#linechart_general_form'
               data-legend-selector="#legend"
               data-smoother-selector="#smoother"
               data-slider-selector="#slider">
          </div>
          <div id="slider"></div>
        </div>
        <div class="span3 legend_container">
          <div class="span9 chart_container" style="width: 400px;">
          <div class="chart"
               data-chart-type="line_chart"
               data-url="{% url 'horizon:admin:metering:samples'%}?meter=memory.usage&group_by=project&date_options=null&resource_id={{ instance.id }}"
               data-form-selector='#linechart_general_form'
               data-legend-selector="#legend"
               data-smoother-selector="#smoother"
               data-slider-selector="#slider">
          </div>
          <div id="slider"></div>
        </div>
        
        </div>
      </div>
    </div>
  </div>
</div>

<div class="info row-fluid detail">
  <div class="span12">
    <h4 class="meter_image" id="network_bytes_image"><span style="line-height:2.5">{% trans "network.bytes" %}</span><span style="margin-left:87.5%;cursor:pointer" onClick="showNetworkBytes();">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></h4>
    <hr class="header_rule" />
    <div id="network_bytes" class="info row-fluid detail">
      <div class="span9 chart_container">
          <div class="chart"
               data-chart-type="line_chart"
               data-url="{% url 'horizon:admin:metering:samples'%}?meter=network.ingoing.bytes-network.outgoing.bytes&group_by=project&date_options=null&resource_id={{ instance.id }}"
               data-form-selector='#linechart_general_form'
               data-legend-selector="#legend"
               data-smoother-selector="#smoother"
               data-slider-selector="#slider">
          </div>
          <div id="slider"></div>
        </div>
        
      </div>
    </div>
  </div>
</div>

<div class="info row-fluid detail">
  <div class="span12">
  
    <h4 class="meter_image" id="network_packets_image"><span style="line-height:2.5">{% trans "network.packets" %}</span><span style="margin-left:86%;cursor:pointer" onClick="showNetworkPackets();">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></h4>
    <hr class="header_rule" />
    <div id="network_packets" class="info row-fluid detail">
      <div class="span9 chart_container">
          <div class="chart"
               data-chart-type="line_chart"
               data-url="{% url 'horizon:admin:metering:samples'%}?meter=network.ingoing.packets-network.outgoing.packets&group_by=project&date_options=null&resource_id={{ instance.id }}"
               data-form-selector='#linechart_general_form'
               data-legend-selector="#legend"
               data-smoother-selector="#smoother"
               data-slider-selector="#slider">
          </div>
          <div id="slider"></div>
        </div>
       
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
<!--
  if (typeof horizon.d3_line_chart !== 'undefined') {
    horizon.d3_line_chart_ceilometer.init("div[data-chart-type='line_chart']",
      {'auto_resize': true});
  }
  -->

  function timing_refresh(mark){
    //var self = this_val;
    //var selector = settings_val;
  	tid = setInterval(function(){inner_fun()},10000);
    var current_val = null
    function inner_fun(){
      console.log(1111111111)
//      console.log(this_vals)
      if (mark == 1) {
        inner_run(this_vals[0]);
        inner_run(this_vals[1]);
      } else if (mark == 2) {
        inner_run(this_vals[2]);
        inner_run(this_vals[3]);
      } else if (mark == 3) {
        inner_run(this_vals[4]);
      } else if (mark == 4) {
        inner_run(this_vals[5]);
      }
    	//horizon.d3_line_chart_ceilometer.
      //  refresh(this_vals, settings_val)
    }
    function inner_run(val) {
      console.log("run tid:" + tid)
      horizon.d3_line_chart_ceilometer.
        refresh(val, settings_val)
    }
    return tid;
  }
  function clear_refresh(id){
  	clearInterval(id);
  }
  function showCPU(){
     mark = 1;
     var obj = document.getElementById('cpu_cup_util');
     var bgimage = document.getElementById('cpu_title_image');
  	 cpu_status = switchImage(obj,bgimage,mark);    
  }
  function showMemory(){
     mark = 2;
     var obj = document.getElementById('memory_memory_usage');
     var bgimage = document.getElementById('memory_title_image');
  	 memory_status = switchImage(obj,bgimage,mark);
  }
  function showNetworkBytes(){
     mark = 3;
     var obj = document.getElementById('network_bytes');
     var bgimage = document.getElementById('network_bytes_image');
  	 network_bytes_status = switchImage(obj,bgimage,mark);
  }
  function showNetworkPackets(){
     mark = 4;
     var obj = document.getElementById('network_packets');
     var bgimage = document.getElementById('network_packets_image');
  	 network_packets = switchImage(obj,bgimage,mark);
  }
  function switchImage(obj,bgimage,mark){
  	if(obj.style.display=="none"){
  		obj.style.display = "block";
  		bgimage.style.backgroundImage = "url(/static/dashboard/img/drop_arrow_l2.png)";
      return timing_refresh(mark);
  	} else {
      clearInterval(all_refresh_id)
  		obj.style.display = "none";
  		bgimage.style.backgroundImage = "url(/static/dashboard/img/right_droparrow_l2.png)";
      if (mark == 1) { 
        tid = cpu_status;
        clear_refresh(cpu_status);
      } else if (mark == 2) {
        tid = memory_status;
        clear_refresh(memory_status);
      } else if (mark == 3) {
        tid = network_bytes_status
        clear_refresh(network_bytes_status);
      } else if (mark == 4) {
        tid = network_packets;
        clear_refresh(network_packets);
      }
      //clear_refresh(tid);
  	}
  }
 </script>
